<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en" lang="en" data-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>index</title>

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- CSS -->
<link rel="stylesheet" type="text/css" href="nimdoc.out.css?v=2.2.4">

<!-- JS -->
<script type="text/javascript" src="dochack.js?v=2.2.4"></script>
</head>
<body>
  <div class="document" id="documentId">
    <div class="container">
      <h1 class="title">index</h1>
      
<h1 id="reliq-lattice-field-theory-framework">ReliQ Lattice Field Theory Framework</h1><blockquote class="markdown-quote"><p><em>&quot;Documentation is a love letter that you write to your future self.&quot;</em> — Damian Conway</p></blockquote>

<h2 id="overview">Overview</h2><p><strong>ReliQ</strong> is an experimental lattice field theory (LFT) framework written in <a class="reference external" href="https://nim-lang.org/">Nim</a>, designed for user-friendliness, performance, reliability, and portability across current and future heterogeneous architectures.</p>

<h3 id="key-features">Key Features</h3><ul class="simple"><li><strong>Multi-backend dispatch</strong>: OpenCL (GPU JIT), SYCL (pre-compiled GPU/CPU), OpenMP (SIMD-vectorized CPU) — all sharing the same user-facing API</li>
<li><strong>AoSoA memory layout</strong>: Array of Structures of Arrays for optimal SIMD and GPU memory coalescing</li>
<li><strong>Distributed memory</strong>: MPI-based parallelism via <a class="reference external" href="https://globalarrays.github.io/">Global Arrays</a> with automatic ghost region management and distributed transport (<tt class="docutils literal"><span class="pre">GlobalShifter</span></tt>, <tt class="docutils literal"><span class="pre">discreteLaplacian</span></tt>)</li>
<li><strong>Layered tensor fields</strong>: <tt class="docutils literal"><span class="pre">TensorField</span></tt> (distributed GA) → <tt class="docutils literal"><span class="pre">LocalTensorField</span></tt> (contiguous host buffer) → <tt class="docutils literal"><span class="pre">TensorFieldView</span></tt> (device-side AoSoA views)</li>
<li><strong>Unified stencil operations</strong>: A single <tt class="docutils literal"><span class="pre">LatticeStencil[D]</span></tt> type that works identically across all backends, handling periodic boundary conditions and ghost regions automatically</li>
<li><strong>Macro-based dispatch</strong>: The <tt class="docutils literal"><span class="pre">each</span></tt> macro analyzes loop bodies at compile time and generates optimized backend-specific code</li>
</ul>

<h2 id="quick-start">Quick Start</h2><p><pre class="listing"><span class="Keyword">import</span> <span class="Identifier">reliq</span>

<span class="Identifier">parallel</span><span class="Punctuation">:</span>
  <span class="Comment"># Create a 4D lattice (8×8×8×16) with MPI decomposition</span>
  <span class="Keyword">let</span> <span class="Identifier">lat</span> <span class="Operator">=</span> <span class="Identifier">newSimpleCubicLattice</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">8</span><span class="Punctuation">,</span> <span class="DecNumber">8</span><span class="Punctuation">,</span> <span class="DecNumber">8</span><span class="Punctuation">,</span> <span class="DecNumber">16</span><span class="Punctuation">]</span><span class="Punctuation">)</span>
  
  <span class="Keyword">block</span><span class="Punctuation">:</span>
    <span class="Comment"># Create tensor fields on the lattice</span>
    <span class="Keyword">var</span> <span class="Identifier">fieldA</span> <span class="Operator">=</span> <span class="Identifier">lat</span><span class="Operator">.</span><span class="Identifier">newTensorField</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="DecNumber">3</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">float64</span>
    <span class="Keyword">var</span> <span class="Identifier">fieldB</span> <span class="Operator">=</span> <span class="Identifier">lat</span><span class="Operator">.</span><span class="Identifier">newTensorField</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="DecNumber">3</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">float64</span>
    <span class="Keyword">var</span> <span class="Identifier">fieldC</span> <span class="Operator">=</span> <span class="Identifier">lat</span><span class="Operator">.</span><span class="Identifier">newTensorField</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="DecNumber">3</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">float64</span>
    
    <span class="Comment"># Get local host-memory views</span>
    <span class="Keyword">var</span> <span class="Identifier">localA</span> <span class="Operator">=</span> <span class="Identifier">fieldA</span><span class="Operator">.</span><span class="Identifier">newLocalTensorField</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
    <span class="Keyword">var</span> <span class="Identifier">localB</span> <span class="Operator">=</span> <span class="Identifier">fieldB</span><span class="Operator">.</span><span class="Identifier">newLocalTensorField</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
    <span class="Keyword">var</span> <span class="Identifier">localC</span> <span class="Operator">=</span> <span class="Identifier">fieldC</span><span class="Operator">.</span><span class="Identifier">newLocalTensorField</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
    
    <span class="Comment"># Host-side initialization with &quot;for all&quot; loop</span>
    <span class="Keyword">for</span> <span class="Identifier">n</span> <span class="Keyword">in</span> <span class="Identifier">all</span> <span class="FloatNumber">0.</span><span class="Operator">.&lt;</span><span class="Identifier">localA</span><span class="Operator">.</span><span class="Identifier">numSites</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
      <span class="Keyword">var</span> <span class="Identifier">siteA</span> <span class="Operator">=</span> <span class="Identifier">localA</span><span class="Operator">.</span><span class="Identifier">getSite</span><span class="Punctuation">(</span><span class="Identifier">n</span><span class="Punctuation">)</span>
      <span class="Identifier">siteA</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">,</span> <span class="DecNumber">0</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="FloatNumber">1.0</span>  <span class="Comment"># Set matrix element (0,0)</span>
    
    <span class="Comment"># Create device views for backend dispatch</span>
    <span class="Keyword">var</span> <span class="Identifier">vA</span> <span class="Operator">=</span> <span class="Identifier">localA</span><span class="Operator">.</span><span class="Identifier">newTensorFieldView</span><span class="Punctuation">(</span><span class="Identifier">iokRead</span><span class="Punctuation">)</span>
    <span class="Keyword">var</span> <span class="Identifier">vB</span> <span class="Operator">=</span> <span class="Identifier">localB</span><span class="Operator">.</span><span class="Identifier">newTensorFieldView</span><span class="Punctuation">(</span><span class="Identifier">iokRead</span><span class="Punctuation">)</span>
    <span class="Keyword">var</span> <span class="Identifier">vC</span> <span class="Operator">=</span> <span class="Identifier">localC</span><span class="Operator">.</span><span class="Identifier">newTensorFieldView</span><span class="Punctuation">(</span><span class="Identifier">iokWrite</span><span class="Punctuation">)</span>
    
    <span class="Comment"># Device-side computation with &quot;each&quot; loop</span>
    <span class="Keyword">for</span> <span class="Identifier">n</span> <span class="Keyword">in</span> <span class="Identifier">each</span> <span class="FloatNumber">0.</span><span class="Operator">.&lt;</span><span class="Identifier">vA</span><span class="Operator">.</span><span class="Identifier">numSites</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
      <span class="Identifier">vC</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">vA</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">+</span> <span class="Identifier">vB</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span>      <span class="Comment"># Matrix addition</span>
      <span class="Identifier">vC</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">vA</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">*</span> <span class="Identifier">vB</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span>      <span class="Comment"># Matrix multiplication</span>
      <span class="Identifier">vC</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="FloatNumber">3.0</span> <span class="Operator">*</span> <span class="Identifier">vA</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span>        <span class="Comment"># Scalar multiplication</span></pre></p>

<h2 id="architecture">Architecture</h2><p>ReliQ is organized into several layers.  Each pillar has its own detailed guide page:</p>
<ul class="simple"><li><a class="reference external" href="lattice_guide.html">Lattice Infrastructure</a> — Geometry, coordinates, stencils</li>
<li><a class="reference external" href="tensor_guide.html">Tensor Fields</a> — TensorField, LocalTensorField, TensorFieldView, transport</li>
<li><a class="reference external" href="backends_guide.html">Compute Backends</a> — OpenCL, SYCL, OpenMP dispatch</li>
<li><a class="reference external" href="simd_guide.html">SIMD Infrastructure</a> — SimdVec types, AoSoA layout computation</li>
<li><a class="reference external" href="distributed_guide.html">Distributed Memory</a> — Global Arrays, MPI, ghost exchange</li>
<li><a class="reference external" href="io_guide.html">I/O Module</a> — LIME, SciDAC, ILDG file formats</li>
</ul>
<p><pre class="listing">┌──────────────────────────────────────────────────────────┐
│                       User Code                          │
│           import reliq; for n in each ...: ...           │
├──────────────────────────────────────────────────────────┤
│                    Tensor Layer                          │
│   TensorField ─► LocalTensorField ─► TensorFieldView    │
│   (GA/MPI)        (host buffer)       (device buffers)   │
├──────────────────────────────────────────────────────────┤
│        GlobalShifter · LatticeStencil · Transporter      │
│        discreteLaplacian · applyStencilShift             │
├──────────────────────────────────────────────────────────┤
│                 Backend Dispatch                         │
│     OpenCL (JIT)  │  SYCL (pre-compiled)  │  OpenMP     │
│      (cldisp)     │    (sycldisp)         │  (ompdisp)  │
├──────────────────────────────────────────────────────────┤
│              Memory &amp; Communication                      │
│   Global Arrays · MPI · AoSoA Layout · SIMD Intrinsics   │
└──────────────────────────────────────────────────────────┘</pre></p>

<h3 id="data-flow">Data Flow</h3><ol class="simple"><li><strong>``TensorField[D,R,L,T]``</strong> — Distributed tensor field stored as a Global Array with ghost regions.  Created with <tt class="docutils literal"><span class="pre">lat.newTensorField(shape): T</span></tt>.</li>
<li><strong>``LocalTensorField[D,R,L,T]``</strong> — Contiguous host-memory copy of the rank-local partition.  Elements are stored in flat AoS order: <tt class="docutils literal"><span class="pre">data[site * elemsPerSite + e]</span></tt>.  Created with <tt class="docutils literal"><span class="pre">field.newLocalTensorField()</span></tt>.  Call <tt class="docutils literal"><span class="pre">releaseLocalTensorField()</span></tt> to copy changes back to the GA.</li>
<li><strong>``TensorFieldView[L,T]``</strong> — Device-side view with AoSoA layout for SIMD or GPU buffers.  Created with <tt class="docutils literal"><span class="pre">local.newTensorFieldView(iokRead)</span></tt> (or <tt class="docutils literal"><span class="pre">iokWrite</span></tt>/<tt class="docutils literal"><span class="pre">iokReadWrite</span></tt>). This is the type the <tt class="docutils literal"><span class="pre">each</span></tt> macro operates on.</li>
</ol>

<h2 id="module-reference">Module Reference</h2>
<h3 id="core-modules">Core Modules</h3><ul class="simple"><li><a class="reference external" href="reliq.html">reliq</a> — Top-level entry point; re-exports all public modules</li>
<li><a class="reference external" href="lattice.html">lattice</a> — Lattice types, stencils, and concepts</li>
<li><a class="reference external" href="parallel.html">parallel</a> — Backend-agnostic parallel dispatch</li>
</ul>

<h3 id="lattice">Lattice</h3><ul class="simple"><li><a class="reference external" href="lattice/latticeconcept.html">lattice/latticeconcept</a> — The <tt class="docutils literal"><span class="pre">Lattice[D]</span></tt> concept that all lattice types must satisfy</li>
<li><a class="reference external" href="lattice/simplecubiclattice.html">lattice/simplecubiclattice</a> — <tt class="docutils literal"><span class="pre">SimpleCubicLattice[D]</span></tt> with MPI decomposition and ghost grids</li>
<li><a class="reference external" href="lattice/stencil.html">lattice/stencil</a> — Unified stencil operations: <tt class="docutils literal"><span class="pre">LatticeStencil[D]</span></tt>, <tt class="docutils literal"><span class="pre">StencilPattern[D]</span></tt>, neighbor access, shift API</li>
<li><a class="reference external" href="lattice/indexing.html">lattice/indexing</a> — Coordinate ↔ flat index conversion utilities</li>
</ul>

<h3 id="tensor-fields">Tensor Fields</h3><ul class="simple"><li><a class="reference external" href="tensor/tensor.html">tensor/tensor</a> — Tensor module aggregation; re-exports all tensor submodules</li>
<li><a class="reference external" href="tensor/globaltensor.html">tensor/globaltensor</a> — <tt class="docutils literal"><span class="pre">TensorField[D,R,L,T]</span></tt>: distributed tensor field with ghost-padded GA memory layout, <tt class="docutils literal"><span class="pre">GlobalShifter</span></tt> for distributed transport, <tt class="docutils literal"><span class="pre">discreteLaplacian</span></tt>, coordinate utilities, and <tt class="docutils literal"><span class="pre">LatticeStencil</span></tt> integration</li>
<li><a class="reference external" href="tensor/localtensor.html">tensor/localtensor</a> — <tt class="docutils literal"><span class="pre">LocalTensorField[D,R,L,T]</span></tt>: contiguous host buffer with flat AoS element access, site proxies for <tt class="docutils literal"><span class="pre">all</span></tt> loops, arithmetic operators</li>
<li><a class="reference external" href="tensor/tensorview.html">tensor/tensorview</a> — <tt class="docutils literal"><span class="pre">TensorFieldView[L,T]</span></tt>: device-side views for the <tt class="docutils literal"><span class="pre">each</span></tt> macro; handles AoSoA layout transformation across OpenCL, SYCL, and OpenMP backends</li>
<li><a class="reference external" href="tensor/sitetensor.html">tensor/sitetensor</a> — <tt class="docutils literal"><span class="pre">Vec[N,T]</span></tt> and <tt class="docutils literal"><span class="pre">Mat[N,M,T]</span></tt>: compile-time dimensioned site-level tensor types</li>
<li><a class="reference external" href="tensor/transporter.html">tensor/transporter</a> — <tt class="docutils literal"><span class="pre">Shifter[D,T]</span></tt> and <tt class="docutils literal"><span class="pre">Transporter[D,U,F]</span></tt>: single-rank parallel transport with halo exchange</li>
</ul>

<h3 id="backendcolon-opencl">Backend: OpenCL</h3><ul class="simple"><li><a class="reference external" href="opencl/cldisp.html">opencl/cldisp</a> — <tt class="docutils literal"><span class="pre">each</span></tt> macro: compile-time expression analysis → OpenCL kernel generation (JIT)</li>
<li><a class="reference external" href="opencl/clbase.html">opencl/clbase</a> — OpenCL platform/device/buffer management and math intrinsics</li>
</ul>

<h3 id="backendcolon-sycl">Backend: SYCL</h3><ul class="simple"><li><a class="reference external" href="sycl/sycldisp.html">sycl/sycldisp</a> — <tt class="docutils literal"><span class="pre">each</span></tt> macro: compile-time expression analysis → pre-compiled C++ SYCL kernel dispatch</li>
<li><a class="reference external" href="sycl/syclbase.html">sycl/syclbase</a> — SYCL queue/buffer management</li>
<li><a class="reference external" href="sycl/syclwrap.html">sycl/syclwrap</a> — Low-level FFI bindings to <tt class="docutils literal"><span class="pre">libreliq_sycl.so</span></tt></li>
</ul>

<h3 id="backendcolon-openmp">Backend: OpenMP</h3><ul class="simple"><li><a class="reference external" href="openmp/ompdisp.html">openmp/ompdisp</a> — <tt class="docutils literal"><span class="pre">each</span></tt> macro: compile-time expression analysis → SIMD-vectorized OpenMP code generation</li>
<li><a class="reference external" href="openmp/ompbase.html">openmp/ompbase</a> — OpenMP initialization and thread management</li>
<li><a class="reference external" href="openmp/ompsimd.html">openmp/ompsimd</a> — SIMD-aware dispatch with outer/inner loop pattern</li>
</ul>

<h3 id="simd-infrastructure">SIMD Infrastructure</h3><ul class="simple"><li><a class="reference external" href="simd/simdtypes.html">simd/simdtypes</a> — <tt class="docutils literal"><span class="pre">SimdVec[N,T]</span></tt> and <tt class="docutils literal"><span class="pre">SimdVecDyn[T]</span></tt>: generic SIMD vector types abstracting SSE/AVX2/AVX-512</li>
<li><a class="reference external" href="simd/simdlayout.html">simd/simdlayout</a> — <tt class="docutils literal"><span class="pre">SimdLatticeLayout</span></tt>: AoSoA memory layout computation for SIMD-vectorized lattice traversal</li>
</ul>

<h3 id="distributed-memory">Distributed Memory</h3><ul class="simple"><li><a class="reference external" href="globalarrays/gatypes.html">globalarrays/gatypes</a> — <tt class="docutils literal"><span class="pre">GlobalArray[D,T]</span></tt>: distributed array with ghost regions via Global Arrays</li>
<li><a class="reference external" href="globalarrays/gabase.html">globalarrays/gabase</a> — Global Arrays initialization and finalization</li>
<li><a class="reference external" href="globalarrays/gawrap.html">globalarrays/gawrap</a> — Low-level C FFI bindings to the Global Arrays library</li>
<li><a class="reference external" href="globalarrays/gampi.html">globalarrays/gampi</a> — MPI initialization and communication primitives</li>
</ul>

<h3 id="islasho">I/O</h3><ul class="simple"><li><a class="reference external" href="io/io.html">io/io</a> — Unified I/O for lattice data: LIME containers, SciDAC format with XML metadata, ILDG gauge configurations, QIO parallel I/O</li>
</ul>

<h3 id="utilities">Utilities</h3><ul class="simple"><li><a class="reference external" href="utils/complex.html">utils/complex</a> — Complex number type predicates</li>
<li><a class="reference external" href="utils/private.html">utils/private</a> — Internal utility functions</li>
</ul>

<h2 id="backend-selection">Backend Selection</h2><p>ReliQ supports three compute backends, selected at compile time:</p>
<table border="1" class="docutils"><tr><th>Backend</th><th>Flag</th><th>Requirements</th><th>Best For</th></tr>
<tr><td>OpenCL</td><td><em>(default)</em></td><td>OpenCL runtime (pocl, vendor SDK)</td><td>GPUs, FPGAs</td></tr>
<tr><td>SYCL</td><td><tt class="docutils literal"><span class="pre">BACKEND=sycl</span></tt></td><td>Intel oneAPI (icpx) or hipSYCL</td><td>Intel GPUs, modern CPUs</td></tr>
<tr><td>OpenMP</td><td><tt class="docutils literal"><span class="pre">BACKEND=openmp</span></tt></td><td>GCC/Clang with OpenMP</td><td>CPU-only, SIMD vectorization</td></tr>
</table>
<h3 id="building">Building</h3><p><pre class="listing"># OpenCL (default)
make tensorview

# OpenMP
make tensorview BACKEND=openmp

# SYCL (requires building the wrapper library first)
make sycl-lib
make tensorview BACKEND=sycl</pre></p>

<h3 id="running-tests">Running Tests</h3><p><pre class="listing"># Run all tests across all backends
make test

# Run tests for a specific backend
make test-core       # Backend-agnostic core tests
make test-opencl     # OpenCL backend tests
make test-openmp     # OpenMP backend tests
make test-sycl       # SYCL backend tests</pre></p>

<h2 id="the-each-macro">The <tt class="docutils literal"><span class="pre">each</span></tt> Macro</h2><p>The <tt class="docutils literal"><span class="pre">each</span></tt> macro is the primary mechanism for expressing computations on lattice fields. It analyzes the loop body at compile time and generates optimized backend-specific code.</p>

<h3 id="creating-tensor-fields-and-views">Creating Tensor Fields and Views</h3><p><pre class="listing"><span class="Keyword">import</span> <span class="Identifier">reliq</span>

<span class="Identifier">parallel</span><span class="Punctuation">:</span>
  <span class="Keyword">let</span> <span class="Identifier">lat</span> <span class="Operator">=</span> <span class="Identifier">newSimpleCubicLattice</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">8</span><span class="Punctuation">,</span> <span class="DecNumber">8</span><span class="Punctuation">,</span> <span class="DecNumber">8</span><span class="Punctuation">,</span> <span class="DecNumber">16</span><span class="Punctuation">]</span><span class="Punctuation">)</span>
  
  <span class="Keyword">block</span><span class="Punctuation">:</span>
    <span class="Comment"># Create distributed tensor fields</span>
    <span class="Keyword">var</span> <span class="Identifier">fieldA</span> <span class="Operator">=</span> <span class="Identifier">lat</span><span class="Operator">.</span><span class="Identifier">newTensorField</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="DecNumber">3</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">float64</span>    <span class="Comment"># 3x3 matrix field</span>
    <span class="Keyword">var</span> <span class="Identifier">fieldB</span> <span class="Operator">=</span> <span class="Identifier">lat</span><span class="Operator">.</span><span class="Identifier">newTensorField</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="DecNumber">3</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">float64</span>
    <span class="Keyword">var</span> <span class="Identifier">fieldC</span> <span class="Operator">=</span> <span class="Identifier">lat</span><span class="Operator">.</span><span class="Identifier">newTensorField</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="DecNumber">3</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">float64</span>
    
    <span class="Comment"># Get local host-memory views</span>
    <span class="Keyword">var</span> <span class="Identifier">localA</span> <span class="Operator">=</span> <span class="Identifier">fieldA</span><span class="Operator">.</span><span class="Identifier">newLocalTensorField</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
    <span class="Keyword">var</span> <span class="Identifier">localB</span> <span class="Operator">=</span> <span class="Identifier">fieldB</span><span class="Operator">.</span><span class="Identifier">newLocalTensorField</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
    <span class="Keyword">var</span> <span class="Identifier">localC</span> <span class="Operator">=</span> <span class="Identifier">fieldC</span><span class="Operator">.</span><span class="Identifier">newLocalTensorField</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
    
    <span class="Comment"># Create device-side views</span>
    <span class="Keyword">var</span> <span class="Identifier">vA</span> <span class="Operator">=</span> <span class="Identifier">localA</span><span class="Operator">.</span><span class="Identifier">newTensorFieldView</span><span class="Punctuation">(</span><span class="Identifier">iokRead</span><span class="Punctuation">)</span>      <span class="Comment"># read-only</span>
    <span class="Keyword">var</span> <span class="Identifier">vB</span> <span class="Operator">=</span> <span class="Identifier">localB</span><span class="Operator">.</span><span class="Identifier">newTensorFieldView</span><span class="Punctuation">(</span><span class="Identifier">iokRead</span><span class="Punctuation">)</span>      <span class="Comment"># read-only</span>
    <span class="Keyword">var</span> <span class="Identifier">vC</span> <span class="Operator">=</span> <span class="Identifier">localC</span><span class="Operator">.</span><span class="Identifier">newTensorFieldView</span><span class="Punctuation">(</span><span class="Identifier">iokWrite</span><span class="Punctuation">)</span>     <span class="Comment"># write-only</span></pre></p>

<h3 id="supported-operations">Supported Operations</h3><p><pre class="listing">    <span class="Comment"># Vector/matrix copy</span>
    <span class="Keyword">for</span> <span class="Identifier">n</span> <span class="Keyword">in</span> <span class="Identifier">each</span> <span class="FloatNumber">0.</span><span class="Operator">.&lt;</span><span class="Identifier">vC</span><span class="Operator">.</span><span class="Identifier">numSites</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
      <span class="Identifier">vC</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">vA</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span>
    
    <span class="Comment"># Scalar multiplication</span>
    <span class="Keyword">for</span> <span class="Identifier">n</span> <span class="Keyword">in</span> <span class="Identifier">each</span> <span class="FloatNumber">0.</span><span class="Operator">.&lt;</span><span class="Identifier">vC</span><span class="Operator">.</span><span class="Identifier">numSites</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
      <span class="Identifier">vC</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="FloatNumber">3.0</span> <span class="Operator">*</span> <span class="Identifier">vA</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span>
    
    <span class="Comment"># Matrix multiplication</span>
    <span class="Keyword">for</span> <span class="Identifier">n</span> <span class="Keyword">in</span> <span class="Identifier">each</span> <span class="FloatNumber">0.</span><span class="Operator">.&lt;</span><span class="Identifier">vC</span><span class="Operator">.</span><span class="Identifier">numSites</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
      <span class="Identifier">vC</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">vA</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">*</span> <span class="Identifier">vB</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span>
    
    <span class="Comment"># Addition / subtraction</span>
    <span class="Keyword">for</span> <span class="Identifier">n</span> <span class="Keyword">in</span> <span class="Identifier">each</span> <span class="FloatNumber">0.</span><span class="Operator">.&lt;</span><span class="Identifier">vC</span><span class="Operator">.</span><span class="Identifier">numSites</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
      <span class="Identifier">vC</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">vA</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">+</span> <span class="Identifier">vB</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span>
    
    <span class="Comment"># Combined expressions</span>
    <span class="Keyword">for</span> <span class="Identifier">n</span> <span class="Keyword">in</span> <span class="Identifier">each</span> <span class="FloatNumber">0.</span><span class="Operator">.&lt;</span><span class="Identifier">vC</span><span class="Operator">.</span><span class="Identifier">numSites</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
      <span class="Identifier">vC</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">vA</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">*</span> <span class="Identifier">vB</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">+</span> <span class="Identifier">vC</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span></pre></p>

<h3 id="stencil-neighbor-access">Stencil Neighbor Access</h3><p><pre class="listing">    <span class="Keyword">let</span> <span class="Identifier">stencil</span> <span class="Operator">=</span> <span class="Identifier">newLatticeStencil</span><span class="Punctuation">(</span><span class="Identifier">nearestNeighborStencil</span><span class="Punctuation">[</span><span class="DecNumber">4</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">,</span> <span class="Identifier">lat</span><span class="Punctuation">)</span>
    
    <span class="Keyword">for</span> <span class="Identifier">n</span> <span class="Keyword">in</span> <span class="Identifier">each</span> <span class="FloatNumber">0.</span><span class="Operator">.&lt;</span><span class="Identifier">vC</span><span class="Operator">.</span><span class="Identifier">numSites</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
      <span class="Keyword">let</span> <span class="Identifier">fwd</span> <span class="Operator">=</span> <span class="Identifier">stencil</span><span class="Operator">.</span><span class="Identifier">fwd</span><span class="Punctuation">(</span><span class="Identifier">n</span><span class="Punctuation">,</span> <span class="DecNumber">0</span><span class="Punctuation">)</span>     <span class="Comment"># Forward x-neighbor</span>
      <span class="Keyword">let</span> <span class="Identifier">bwd</span> <span class="Operator">=</span> <span class="Identifier">stencil</span><span class="Operator">.</span><span class="Identifier">bwd</span><span class="Punctuation">(</span><span class="Identifier">n</span><span class="Punctuation">,</span> <span class="DecNumber">0</span><span class="Punctuation">)</span>     <span class="Comment"># Backward x-neighbor</span>
      <span class="Identifier">vC</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">vA</span><span class="Punctuation">[</span><span class="Identifier">fwd</span><span class="Punctuation">]</span> <span class="Operator">+</span> <span class="Identifier">vA</span><span class="Punctuation">[</span><span class="Identifier">bwd</span><span class="Punctuation">]</span> <span class="Operator">-</span> <span class="FloatNumber">2.0</span> <span class="Operator">*</span> <span class="Identifier">vA</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span></pre></p>

<h3 id="what-happens-under-the-hood">What Happens Under the Hood</h3><ol class="simple"><li><strong>Parse</strong>: The macro receives the loop body as an AST</li>
<li><strong>Analyze</strong>: Expression trees are classified (copy, add, matmul, etc.)</li>
<li><strong>Detect stencils</strong>: Stencil neighbor patterns are detected and tracked</li>
<li><strong>Generate</strong>: Backend-specific code is emitted:<ul class="simple"><li><strong>OpenCL</strong>: An OpenCL C kernel string is JIT-compiled and dispatched with <tt class="docutils literal"><span class="pre">clEnqueueNDRangeKernel</span></tt></li>
<li><strong>SYCL</strong>: Calls to pre-compiled C++ template kernels in <tt class="docutils literal"><span class="pre">libreliq_sycl.so</span></tt> are emitted</li>
<li><strong>OpenMP</strong>: SIMD-vectorized C code with <tt class="docutils literal"><span class="pre">#pragma omp parallel for</span></tt> and explicit SIMD intrinsic calls is generated</li>
</ul>
</li>
</ol>

<h2 id="the-all-loop">The <tt class="docutils literal"><span class="pre">all</span></tt> Loop</h2><p>The <tt class="docutils literal"><span class="pre">all</span></tt> loop operates on <tt class="docutils literal"><span class="pre">LocalTensorField</span></tt> objects for host-side site-level operations using <tt class="docutils literal"><span class="pre">LocalSiteProxy</span></tt>:</p>
<p><pre class="listing">    <span class="Comment"># Initialize via site proxy</span>
    <span class="Keyword">for</span> <span class="Identifier">n</span> <span class="Keyword">in</span> <span class="Identifier">all</span> <span class="FloatNumber">0.</span><span class="Operator">.&lt;</span><span class="Identifier">localA</span><span class="Operator">.</span><span class="Identifier">numSites</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
      <span class="Keyword">var</span> <span class="Identifier">site</span> <span class="Operator">=</span> <span class="Identifier">localA</span><span class="Operator">.</span><span class="Identifier">getSite</span><span class="Punctuation">(</span><span class="Identifier">n</span><span class="Punctuation">)</span>
      <span class="Identifier">site</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">,</span> <span class="DecNumber">0</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="FloatNumber">1.0</span>   <span class="Comment"># Set matrix element (row, col)</span>
    
    <span class="Comment"># Arithmetic operations</span>
    <span class="Keyword">for</span> <span class="Identifier">n</span> <span class="Keyword">in</span> <span class="Identifier">all</span> <span class="FloatNumber">0.</span><span class="Operator">.&lt;</span><span class="Identifier">localC</span><span class="Operator">.</span><span class="Identifier">numSites</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
      <span class="Identifier">localC</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">localA</span><span class="Operator">.</span><span class="Identifier">getSite</span><span class="Punctuation">(</span><span class="Identifier">n</span><span class="Punctuation">)</span> <span class="Operator">+</span> <span class="Identifier">localB</span><span class="Operator">.</span><span class="Identifier">getSite</span><span class="Punctuation">(</span><span class="Identifier">n</span><span class="Punctuation">)</span>   <span class="Comment"># add</span>
      <span class="Identifier">localC</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">localA</span><span class="Operator">.</span><span class="Identifier">getSite</span><span class="Punctuation">(</span><span class="Identifier">n</span><span class="Punctuation">)</span> <span class="Operator">*</span> <span class="Identifier">localB</span><span class="Operator">.</span><span class="Identifier">getSite</span><span class="Punctuation">(</span><span class="Identifier">n</span><span class="Punctuation">)</span>   <span class="Comment"># multiply</span>
      <span class="Identifier">localC</span><span class="Punctuation">[</span><span class="Identifier">n</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="FloatNumber">2.5</span> <span class="Operator">*</span> <span class="Identifier">localA</span><span class="Operator">.</span><span class="Identifier">getSite</span><span class="Punctuation">(</span><span class="Identifier">n</span><span class="Punctuation">)</span>                 <span class="Comment"># scale</span>
    
    <span class="Comment"># Copy changes back to the distributed Global Array</span>
    <span class="Identifier">localC</span><span class="Operator">.</span><span class="Identifier">releaseLocalTensorField</span><span class="Punctuation">(</span><span class="Punctuation">)</span></pre></p>

<h2 id="aosoa-memory-layout">AoSoA Memory Layout</h2><p>ReliQ uses an Array of Structures of Arrays (AoSoA) memory layout for optimal SIMD and GPU performance:</p>
<p><pre class="listing">Traditional AoS:  [s0e0, s0e1, s1e0, s1e1, s2e0, s2e1, ...]
ReliQ AoSoA (VW=4): [s0e0, s1e0, s2e0, s3e0,  ← element 0, group 0
                      s0e1, s1e1, s2e1, s3e1,  ← element 1, group 0
                      s4e0, s5e0, s6e0, s7e0,  ← element 0, group 1
                      s4e1, s5e1, s6e1, s7e1]  ← element 1, group 1</pre></p>
<p><strong>Index formula</strong>: For site <tt class="docutils literal"><span class="pre">s</span></tt> with element index <tt class="docutils literal"><span class="pre">i</span></tt>:</p>
<p><pre class="listing">group = s / VW
lane  = s mod VW
index = group * (elemsPerSite * VW) + i * VW + lane</pre></p>
<p>Where <tt class="docutils literal"><span class="pre">VW</span></tt> (VectorWidth) is typically 8 for CPU (AVX-512) or configurable via <tt class="docutils literal"><span class="pre">-d:VectorWidth=N</span></tt>.</p>

<h2 id="distributed-transport-globalshifter">Distributed Transport (<tt class="docutils literal"><span class="pre">GlobalShifter</span></tt>)</h2><p>For operations that span MPI boundaries at the <tt class="docutils literal"><span class="pre">TensorField</span></tt> level (before down-casting to views), <tt class="docutils literal"><span class="pre">GlobalShifter</span></tt> performs distributed nearest-neighbour shifts using Global Arrays ghost exchange.</p>
<p><pre class="listing"><span class="Identifier">parallel</span><span class="Punctuation">:</span>
  <span class="Keyword">let</span> <span class="Identifier">lat</span> <span class="Operator">=</span> <span class="Identifier">newSimpleCubicLattice</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">8</span><span class="Punctuation">,</span> <span class="DecNumber">8</span><span class="Punctuation">,</span> <span class="DecNumber">8</span><span class="Punctuation">,</span> <span class="DecNumber">16</span><span class="Punctuation">]</span><span class="Punctuation">,</span> <span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">,</span> <span class="DecNumber">1</span><span class="Punctuation">,</span> <span class="DecNumber">1</span><span class="Punctuation">,</span> <span class="DecNumber">4</span><span class="Punctuation">]</span><span class="Punctuation">,</span> <span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">,</span> <span class="DecNumber">1</span><span class="Punctuation">,</span> <span class="DecNumber">1</span><span class="Punctuation">,</span> <span class="DecNumber">1</span><span class="Punctuation">]</span><span class="Punctuation">)</span>
  
  <span class="Keyword">block</span><span class="Punctuation">:</span>
    <span class="Keyword">var</span> <span class="Identifier">src</span>  <span class="Operator">=</span> <span class="Identifier">lat</span><span class="Operator">.</span><span class="Identifier">newTensorField</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">,</span> <span class="DecNumber">1</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">float64</span>
    <span class="Keyword">var</span> <span class="Identifier">dest</span> <span class="Operator">=</span> <span class="Identifier">lat</span><span class="Operator">.</span><span class="Identifier">newTensorField</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">,</span> <span class="DecNumber">1</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">float64</span>
    
    <span class="Comment"># Fill src ...</span>
    
    <span class="Comment"># Shift forward in t-dimension (crosses MPI boundaries)</span>
    <span class="Keyword">let</span> <span class="Identifier">shifter</span> <span class="Operator">=</span> <span class="Identifier">newGlobalShifter</span><span class="Punctuation">(</span><span class="Identifier">src</span><span class="Punctuation">,</span> <span class="Identifier">dim</span><span class="Operator">=</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="Identifier">len</span><span class="Operator">=</span><span class="DecNumber">1</span><span class="Punctuation">)</span>
    <span class="Identifier">shifter</span><span class="Operator">.</span><span class="Identifier">apply</span><span class="Punctuation">(</span><span class="Identifier">src</span><span class="Punctuation">,</span> <span class="Identifier">dest</span><span class="Punctuation">)</span>   <span class="Comment"># dest[x] = src[x + e_t]</span>
    
    <span class="Comment"># Create shifters for all dimensions at once</span>
    <span class="Keyword">let</span> <span class="Identifier">fwd</span> <span class="Operator">=</span> <span class="Identifier">newGlobalShifters</span><span class="Punctuation">(</span><span class="Identifier">src</span><span class="Punctuation">,</span> <span class="Identifier">len</span><span class="Operator">=</span><span class="DecNumber">1</span><span class="Punctuation">)</span>
    <span class="Keyword">let</span> <span class="Identifier">bwd</span> <span class="Operator">=</span> <span class="Identifier">newGlobalBackwardShifters</span><span class="Punctuation">(</span><span class="Identifier">src</span><span class="Punctuation">,</span> <span class="Identifier">len</span><span class="Operator">=</span><span class="DecNumber">1</span><span class="Punctuation">)</span>
    
    <span class="Comment"># Discrete Laplacian: sum_mu (f[x+mu] + f[x-mu]) - 2D * f[x]</span>
    <span class="Keyword">var</span> <span class="Identifier">lap</span> <span class="Operator">=</span> <span class="Identifier">lat</span><span class="Operator">.</span><span class="Identifier">newTensorField</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">,</span> <span class="DecNumber">1</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">float64</span>
    <span class="Keyword">var</span> <span class="Identifier">scratch</span> <span class="Operator">=</span> <span class="Identifier">lat</span><span class="Operator">.</span><span class="Identifier">newTensorField</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">,</span> <span class="DecNumber">1</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">float64</span>
    <span class="Identifier">discreteLaplacian</span><span class="Punctuation">(</span><span class="Identifier">src</span><span class="Punctuation">,</span> <span class="Identifier">lap</span><span class="Punctuation">,</span> <span class="Identifier">scratch</span><span class="Punctuation">)</span></pre></p>

<h3 id="two-transport-layers">Two Transport Layers</h3><table border="1" class="docutils"><tr><th>Layer</th><th>Type</th><th>Communication</th></tr>
<tr><td><tt class="docutils literal"><span class="pre">GlobalShifter</span></tt></td><td><tt class="docutils literal"><span class="pre">TensorField</span></tt></td><td>GA ghost exchange (MPI)</td></tr>
<tr><td><tt class="docutils literal"><span class="pre">Shifter</span></tt> / <tt class="docutils literal"><span class="pre">Transporter</span></tt></td><td><tt class="docutils literal"><span class="pre">TensorFieldView</span></tt></td><td>Device-side halo buffers</td></tr>
</table><p>Use <tt class="docutils literal"><span class="pre">GlobalShifter</span></tt> when working directly with distributed tensor fields (e.g. setup, I/O, measurement code).  Use <tt class="docutils literal"><span class="pre">Shifter</span></tt> / <tt class="docutils literal"><span class="pre">Transporter</span></tt> when the data is already on-device inside an <tt class="docutils literal"><span class="pre">each</span></tt> loop.</p>

<h2 id="islasho">I/O</h2><p>ReliQ supports standard lattice QCD file formats through the <tt class="docutils literal"><span class="pre">io</span></tt> module:</p>
<ul class="simple"><li><strong>LIME containers</strong> — Low-level record reading/writing</li>
<li><strong>SciDAC/QIO</strong> — XML metadata, checksum validation, precision handling</li>
<li><strong>ILDG</strong> — Standard gauge configuration format</li>
</ul>
<p><pre class="listing"><span class="Identifier">parallel</span><span class="Punctuation">:</span>
  <span class="Keyword">let</span> <span class="Identifier">lat</span> <span class="Operator">=</span> <span class="Identifier">newSimpleCubicLattice</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">8</span><span class="Punctuation">,</span> <span class="DecNumber">8</span><span class="Punctuation">,</span> <span class="DecNumber">8</span><span class="Punctuation">,</span> <span class="DecNumber">16</span><span class="Punctuation">]</span><span class="Punctuation">)</span>
  
  <span class="Keyword">block</span><span class="Punctuation">:</span>
    <span class="Comment"># Read an ILDG gauge configuration</span>
    <span class="Keyword">var</span> <span class="Identifier">g0</span> <span class="Operator">=</span> <span class="Identifier">lat</span><span class="Operator">.</span><span class="Identifier">newTensorField</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="DecNumber">3</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">Complex64</span>
    <span class="Keyword">var</span> <span class="Identifier">g1</span> <span class="Operator">=</span> <span class="Identifier">lat</span><span class="Operator">.</span><span class="Identifier">newTensorField</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="DecNumber">3</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">Complex64</span>
    <span class="Keyword">var</span> <span class="Identifier">g2</span> <span class="Operator">=</span> <span class="Identifier">lat</span><span class="Operator">.</span><span class="Identifier">newTensorField</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="DecNumber">3</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">Complex64</span>
    <span class="Keyword">var</span> <span class="Identifier">g3</span> <span class="Operator">=</span> <span class="Identifier">lat</span><span class="Operator">.</span><span class="Identifier">newTensorField</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="DecNumber">3</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">Complex64</span>
    <span class="Keyword">var</span> <span class="Identifier">gaugeField</span> <span class="Operator">=</span> <span class="Punctuation">[</span><span class="Identifier">g0</span><span class="Punctuation">,</span> <span class="Identifier">g1</span><span class="Punctuation">,</span> <span class="Identifier">g2</span><span class="Punctuation">,</span> <span class="Identifier">g3</span><span class="Punctuation">]</span>
    <span class="Identifier">readGaugeField</span><span class="Punctuation">(</span><span class="Identifier">gaugeField</span><span class="Punctuation">,</span> <span class="StringLit">&quot;config.ildg&quot;</span><span class="Punctuation">)</span>
    
    <span class="Comment"># Write a tensor field to LIME/SciDAC format</span>
    <span class="Keyword">var</span> <span class="Identifier">field</span> <span class="Operator">=</span> <span class="Identifier">lat</span><span class="Operator">.</span><span class="Identifier">newTensorField</span><span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="DecNumber">3</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">float64</span>
    <span class="Identifier">writeTensorField</span><span class="Punctuation">(</span><span class="Identifier">field</span><span class="Punctuation">,</span> <span class="StringLit">&quot;output.lime&quot;</span><span class="Punctuation">)</span></pre></p>

<h2 id="license">License</h2><p>MIT License — Copyright (c) 2025 reliq-lft</p>
<p>See <a class="reference external" href="https://github.com/reliq-lft/ReliQ/blob/main/LICENSE">LICENSE</a> for details.</p>



      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br>
        <small style="color: var(--hint);">Made with Nim. Generated: 2026-02-07 06:49:55 UTC</small>
      </div>
    </div>
  </div>
  
</body>
</html>
