<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en" lang="en" data-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>simd/simdlayout</title>

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- CSS -->
<link rel="stylesheet" type="text/css" href="../nimdoc.out.css?v=2.2.4">

<!-- JS -->
<script type="text/javascript" src="../dochack.js?v=2.2.4"></script>
</head>
<body>
  <div class="document" id="documentId">
    <div class="container">
      <h1 class="title">simd/simdlayout</h1>
      <div class="row">
  <div class="three columns">
    <div class="theme-select-wrapper">
      <label for="theme-select">Theme:&nbsp;</label>
      <select id="theme-select" onchange="setTheme(this.value)">
        <option value="auto">ðŸŒ— Match OS</option>
        <option value="dark">ðŸŒ‘ Dark</option>
        <option value="light">ðŸŒ• Light</option>
      </select>
    </div>
    <div id="global-links">
      <ul class="simple">
        <li><a id="indexLink" href="../theindex.html">Index</a></li>
      </ul>
    </div>
    <div id="searchInputDiv">
      Search: <input type="search" id="searchInput" oninput="search()"/>
    </div>
    <div>
      Group by:
      <select onchange="groupBy(this.value)">
        <option value="section">Section</option>
        <option value="type">Type</option>
      </select>
    </div>
    <ul class="simple simple-toc" id="toc-list">
  <li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#7" id="57">Types</a></summary>
    <ul class="simple simple-toc-section">
      <li><a class="reference" href="#SimdLatticeLayout" title="SimdLatticeLayout = object
  nDim*: int                 ## Number of lattice dimensions
  localGeom*: seq[int]       ## Local lattice dimensions
  simdGrid*: seq[int]        ## SIMD lane grid per dimension
  innerGeom*: seq[int]       ## Inner (SIMD) geometry = simdGrid
  outerGeom*: seq[int]       ## Outer geometry = localGeom / simdGrid
  nSitesInner*: int          ## Total SIMD lanes = product(innerGeom)
  nSitesOuter*: int          ## Outer iterations = product(outerGeom)
  nSites*: int               ## Total sites = nSitesInner * nSitesOuter
  innerStrides*: seq[int]    ## Strides for inner (lane) indexing
  outerStrides*: seq[int]    ## Strides for outer (group) indexing
  localStrides*: seq[int]    ## Strides for full local indexing">SimdLatticeLayout</a></li>

    </ul>
  </details>
</li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#12" id="62">Procs</a></summary>
    <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">$
  <li><a class="reference" href="#%24%2CSimdLatticeLayout" title="`$`(layout: SimdLatticeLayout): string">`$`(layout: SimdLatticeLayout): string</a></li>

</ul>
<ul class="simple nested-toc-section">aosoaIndex
  <li><a class="reference" href="#aosoaIndex%2Cint%2Cint%2Cint%2Cint%2Cint" title="aosoaIndex(outerIdx, innerIdx, elemIdx, elemsPerSite, nSitesInner: int): int">aosoaIndex(outerIdx, innerIdx, elemIdx, elemsPerSite, nSitesInner: int): int</a></li>

</ul>
<ul class="simple nested-toc-section">aosoaIndexFromLocal
  <li><a class="reference" href="#aosoaIndexFromLocal%2Cint%2Cint%2Cint%2CSimdLatticeLayout" title="aosoaIndexFromLocal(localIdx, elemIdx, elemsPerSite: int;
                    layout: SimdLatticeLayout): int">aosoaIndexFromLocal(localIdx, elemIdx, elemsPerSite: int;
                    layout: SimdLatticeLayout): int</a></li>

</ul>
<ul class="simple nested-toc-section">computeLocalGeom
  <li><a class="reference" href="#computeLocalGeom%2CopenArray%5Bint%5D%2CopenArray%5Bint%5D" title="computeLocalGeom(globalGeom, mpiGrid: openArray[int]): seq[int]">computeLocalGeom(globalGeom, mpiGrid: openArray[int]): seq[int]</a></li>

</ul>
<ul class="simple nested-toc-section">computeProduct
  <li><a class="reference" href="#computeProduct%2Cseq%5Bint%5D" title="computeProduct(geom: seq[int]): int">computeProduct(geom: seq[int]): int</a></li>

</ul>
<ul class="simple nested-toc-section">computeStrides
  <li><a class="reference" href="#computeStrides%2Cseq%5Bint%5D" title="computeStrides(geom: seq[int]): seq[int]">computeStrides(geom: seq[int]): seq[int]</a></li>

</ul>
<ul class="simple nested-toc-section">coordsToLexicographic
  <li><a class="reference" href="#coordsToLexicographic%2Cseq%5Bint%5D%2Cseq%5Bint%5D" title="coordsToLexicographic(coords: seq[int]; strides: seq[int]): int">coordsToLexicographic(coords: seq[int]; strides: seq[int]): int</a></li>

</ul>
<ul class="simple nested-toc-section">generateCoordTable
  <li><a class="reference" href="#generateCoordTable%2CSimdLatticeLayout" title="generateCoordTable(layout: SimdLatticeLayout): seq[seq[int]]">generateCoordTable(layout: SimdLatticeLayout): seq[seq[int]]</a></li>

</ul>
<ul class="simple nested-toc-section">lexicographicToCoords
  <li><a class="reference" href="#lexicographicToCoords%2Cint%2Cseq%5Bint%5D%2Cseq%5Bint%5D" title="lexicographicToCoords(idx: int; strides: seq[int]; geom: seq[int]): seq[int]">lexicographicToCoords(idx: int; strides: seq[int]; geom: seq[int]): seq[int]</a></li>

</ul>
<ul class="simple nested-toc-section">localToOuterInner
  <li><a class="reference" href="#localToOuterInner%2Cint%2CSimdLatticeLayout" title="localToOuterInner(localIdx: int; layout: SimdLatticeLayout): tuple[
    outer, inner: int]">localToOuterInner(localIdx: int; layout: SimdLatticeLayout): tuple[
    outer, inner: int]</a></li>

</ul>
<ul class="simple nested-toc-section">newSimdLatticeLayout
  <li><a class="reference" href="#newSimdLatticeLayout%2CopenArray%5Bint%5D%2CopenArray%5Bint%5D" title="newSimdLatticeLayout(localGeom: openArray[int]; simdGrid: openArray[int]): SimdLatticeLayout">newSimdLatticeLayout(localGeom: openArray[int]; simdGrid: openArray[int]): SimdLatticeLayout</a></li>
<li><a class="reference" href="#newSimdLatticeLayout%2CopenArray%5Bint%5D%2Cint" title="newSimdLatticeLayout(localGeom: openArray[int]; simdWidth: int): SimdLatticeLayout">newSimdLatticeLayout(localGeom: openArray[int]; simdWidth: int): SimdLatticeLayout</a></li>

</ul>
<ul class="simple nested-toc-section">outerInnerToLocal
  <li><a class="reference" href="#outerInnerToLocal%2Cint%2Cint%2CSimdLatticeLayout" title="outerInnerToLocal(outerIdx, innerIdx: int; layout: SimdLatticeLayout): int">outerInnerToLocal(outerIdx, innerIdx: int; layout: SimdLatticeLayout): int</a></li>

</ul>
<ul class="simple nested-toc-section">simdLanes
  <li><a class="reference" href="#simdLanes%2CSimdLatticeLayout" title="simdLanes(layout: SimdLatticeLayout): int">simdLanes(layout: SimdLatticeLayout): int</a></li>

</ul>
<ul class="simple nested-toc-section">validateSimdGrid
  <li><a class="reference" href="#validateSimdGrid%2CopenArray%5Bint%5D%2CopenArray%5Bint%5D%2CopenArray%5Bint%5D" title="validateSimdGrid(globalGeom, mpiGrid, simdGrid: openArray[int]): tuple[
    valid: bool, message: string]">validateSimdGrid(globalGeom, mpiGrid, simdGrid: openArray[int]): tuple[
    valid: bool, message: string]</a></li>

</ul>
<ul class="simple nested-toc-section">vectorGroups
  <li><a class="reference" href="#vectorGroups%2CSimdLatticeLayout" title="vectorGroups(layout: SimdLatticeLayout): int">vectorGroups(layout: SimdLatticeLayout): int</a></li>

</ul>

    </ul>
  </details>
</li>

</ul>

  </div>
  <div class="nine columns" id="content">
    
    <div id="tocRoot"></div>
    
    <p class="module-desc"><p>SIMD Lattice Layout</p>
<p>This module provides infrastructure for SIMD-vectorized AoSoA (Array of Structures of Arrays) memory layouts for lattice field theory computations.</p>
<p>The key concept is splitting the lattice into:</p>
<ul class="simple"><li><strong>innerGeom</strong>: SIMD lane grid - sites processed together in one SIMD vector</li>
<li><strong>outerGeom</strong>: Remaining sites - outer loop iterates over these</li>
</ul>
<p>For example, on a 4D lattice <a class="reference internal" href="#8,8,8,16">8,8,8,16</a> with simdGrid <a class="reference internal" href="#1,2,2,2">1,2,2,2</a>:</p>
<ul class="simple"><li>innerGeom = <a class="reference internal" href="#1,2,2,2">1,2,2,2</a> â†’ nSitesInner = 8 SIMD lanes</li>
<li>outerGeom = <a class="reference internal" href="#8,4,4,8">8,4,4,8</a> â†’ nSitesOuter = 1024 outer iterations</li>
<li>Total sites = 8 * 1024 = 8192</li>
</ul>
<p>This layout enables efficient SIMD processing where:</p>
<ul class="simple"><li>Outer loop iterates over vector groups (OpenMP parallelized)</li>
<li>Inner &quot;loop&quot; processes VectorWidth sites simultaneously via SIMD</li>
</ul>
<p>MPI Compatibility:</p>
<ul class="simple"><li>The simdGrid operates on the LOCAL lattice (after MPI partitioning)</li>
<li>localGrid = globalGrid / mpiGrid for each dimension</li>
<li>simdGrid must evenly divide localGrid in each dimension</li>
<li>Example: globalGrid=<a class="reference internal" href="#16,16,16,32">16,16,16,32</a>, mpiGrid=<a class="reference internal" href="#2,2,2,2">2,2,2,2</a> â†’ localGrid=<a class="reference internal" href="#8,8,8,16">8,8,8,16</a> Valid simdGrid: <a class="reference internal" href="#1,2,2,2">1,2,2,2</a>, <a class="reference internal" href="#2,2,2,1">2,2,2,1</a>, <a class="reference internal" href="#1,1,1,8">1,1,1,8</a>, etc. Invalid: <a class="reference internal" href="#4,4,1,1">4,4,1,1</a> since 4 doesn't divide 8 and 4 doesn't divide 8 and... wait it does! Actually invalid example: <a class="reference internal" href="#3,1,1,1">3,1,1,1</a> since 3 doesn't divide 8</li>
</ul>
<p>Reference: QEX (<a class="reference external" href="https://github.com/jcosborn/qex">https://github.com/jcosborn/qex</a>) layout implementation</p>
</p>
    <div class="section" id="7">
  <h1><a class="toc-backref" href="#7">Types</a></h1>
  <dl class="item">
    <div id="SimdLatticeLayout">
  <dt><pre><a href="simdlayout.html#SimdLatticeLayout"><span class="Identifier">SimdLatticeLayout</span></a> <span class="Other">=</span> <span class="Keyword">object</span>
  <span class="Identifier">nDim</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">int</span>                 <span class="Comment">## Number of lattice dimensions</span>
  <span class="Identifier">localGeom</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span>       <span class="Comment">## Local lattice dimensions</span>
  <span class="Identifier">simdGrid</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span>        <span class="Comment">## SIMD lane grid per dimension</span>
  <span class="Identifier">innerGeom</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span>       <span class="Comment">## Inner (SIMD) geometry = simdGrid</span>
  <span class="Identifier">outerGeom</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span>       <span class="Comment">## Outer geometry = localGeom / simdGrid</span>
  <span class="Identifier">nSitesInner</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">int</span>          <span class="Comment">## Total SIMD lanes = product(innerGeom)</span>
  <span class="Identifier">nSitesOuter</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">int</span>          <span class="Comment">## Outer iterations = product(outerGeom)</span>
  <span class="Identifier">nSites</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">int</span>               <span class="Comment">## Total sites = nSitesInner * nSitesOuter</span>
  <span class="Identifier">innerStrides</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span>    <span class="Comment">## Strides for inner (lane) indexing</span>
  <span class="Identifier">outerStrides</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span>    <span class="Comment">## Strides for outer (group) indexing</span>
  <span class="Identifier">localStrides</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span>    <span class="Comment">## Strides for full local indexing</span></pre></dt>
  <dd>
    
    <p>SIMD-aware lattice layout for vectorized operations</p>
<p>Stores the decomposition of a lattice into inner (SIMD) and outer (iteration) components for efficient vectorized memory access.</p>

    
  </dd>
</div>

  </dl>
</div>
<div class="section" id="12">
  <h1><a class="toc-backref" href="#12">Procs</a></h1>
  <dl class="item">
    <div id="$-procs-all">
  <div id="$,SimdLatticeLayout">
  <dt><pre><span class="Keyword">proc</span> <a href="#%24%2CSimdLatticeLayout"><span class="Identifier">`$`</span></a><span class="Other">(</span><span class="Identifier">layout</span><span class="Other">:</span> <a href="simdlayout.html#SimdLatticeLayout"><span class="Identifier">SimdLatticeLayout</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">string</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    String representation of SIMD layout
    
  </dd>
</div>

</div>
<div id="aosoaIndex-procs-all">
  <div id="aosoaIndex,int,int,int,int,int">
  <dt><pre><span class="Keyword">proc</span> <a href="#aosoaIndex%2Cint%2Cint%2Cint%2Cint%2Cint"><span class="Identifier">aosoaIndex</span></a><span class="Other">(</span><span class="Identifier">outerIdx</span><span class="Other">,</span> <span class="Identifier">innerIdx</span><span class="Other">,</span> <span class="Identifier">elemIdx</span><span class="Other">,</span> <span class="Identifier">elemsPerSite</span><span class="Other">,</span> <span class="Identifier">nSitesInner</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">int</span> {.
    <span class="Identifier">inline</span><span class="Other">,</span> <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Compute AoSoA memory index for vectorized layout</p>
<p>AoSoA layout: <a class="reference internal" href="#elemIdx">outerIdx</a><a class="reference internal" href="#innerIdx">innerIdx</a></p>
<ul class="simple"><li>outerIdx: vector group index (0 to nSitesOuter-1)</li>
<li>innerIdx: SIMD lane (0 to nSitesInner-1)</li>
<li>elemIdx: element within tensor (0 to elemsPerSite-1)</li>
</ul>
<p>Memory: group0<a class="reference internal" href="#">e0: lane0,lane1,..., e1: lane0,lane1,...</a>, group1<a class="reference internal" href="#...">...</a></p>

    
  </dd>
</div>

</div>
<div id="aosoaIndexFromLocal-procs-all">
  <div id="aosoaIndexFromLocal,int,int,int,SimdLatticeLayout">
  <dt><pre><span class="Keyword">proc</span> <a href="#aosoaIndexFromLocal%2Cint%2Cint%2Cint%2CSimdLatticeLayout"><span class="Identifier">aosoaIndexFromLocal</span></a><span class="Other">(</span><span class="Identifier">localIdx</span><span class="Other">,</span> <span class="Identifier">elemIdx</span><span class="Other">,</span> <span class="Identifier">elemsPerSite</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">;</span>
                         <span class="Identifier">layout</span><span class="Other">:</span> <a href="simdlayout.html#SimdLatticeLayout"><span class="Identifier">SimdLatticeLayout</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">int</span> {.<span class="Identifier">inline</span><span class="Other">,</span> <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    Compute AoSoA memory index from local site index
    
  </dd>
</div>

</div>
<div id="computeLocalGeom-procs-all">
  <div id="computeLocalGeom,openArray[int],openArray[int]">
  <dt><pre><span class="Keyword">proc</span> <a href="#computeLocalGeom%2CopenArray%5Bint%5D%2CopenArray%5Bint%5D"><span class="Identifier">computeLocalGeom</span></a><span class="Other">(</span><span class="Identifier">globalGeom</span><span class="Other">,</span> <span class="Identifier">mpiGrid</span><span class="Other">:</span> <span class="Identifier">openArray</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Compute local geometry from global geometry and MPI grid</p>
<p>Parameters: globalGeom: Global lattice dimensions mpiGrid: MPI rank grid</p>
<p>Returns: Local geometry for each MPI rank: localGeom<a class="reference internal" href="#d">d</a> = globalGeom<a class="reference internal" href="#d">d</a> / mpiGrid<a class="reference internal" href="#d">d</a></p>

    
  </dd>
</div>

</div>
<div id="computeProduct-procs-all">
  <div id="computeProduct,seq[int]">
  <dt><pre><span class="Keyword">proc</span> <a href="#computeProduct%2Cseq%5Bint%5D"><span class="Identifier">computeProduct</span></a><span class="Other">(</span><span class="Identifier">geom</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">int</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    Compute product of all dimensions
    
  </dd>
</div>

</div>
<div id="computeStrides-procs-all">
  <div id="computeStrides,seq[int]">
  <dt><pre><span class="Keyword">proc</span> <a href="#computeStrides%2Cseq%5Bint%5D"><span class="Identifier">computeStrides</span></a><span class="Other">(</span><span class="Identifier">geom</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    Compute lexicographic strides for a geometry stride<a class="reference internal" href="#d">d</a> = product of dimensions 0..&lt;d
    
  </dd>
</div>

</div>
<div id="coordsToLexicographic-procs-all">
  <div id="coordsToLexicographic,seq[int],seq[int]">
  <dt><pre><span class="Keyword">proc</span> <a href="#coordsToLexicographic%2Cseq%5Bint%5D%2Cseq%5Bint%5D"><span class="Identifier">coordsToLexicographic</span></a><span class="Other">(</span><span class="Identifier">coords</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span><span class="Other">;</span> <span class="Identifier">strides</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">int</span> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    Convert coordinates to lexicographic index
    
  </dd>
</div>

</div>
<div id="generateCoordTable-procs-all">
  <div id="generateCoordTable,SimdLatticeLayout">
  <dt><pre><span class="Keyword">proc</span> <a href="#generateCoordTable%2CSimdLatticeLayout"><span class="Identifier">generateCoordTable</span></a><span class="Other">(</span><span class="Identifier">layout</span><span class="Other">:</span> <a href="simdlayout.html#SimdLatticeLayout"><span class="Identifier">SimdLatticeLayout</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span><span class="Other">]</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Generate coordinate lookup table: coordTable<a class="reference internal" href="#lane">outerIdx</a> = localSiteIdx</p>
<p>Pre-computes the mapping from (outerIdx, lane) to local site index for efficient vectorized iteration.</p>

    
  </dd>
</div>

</div>
<div id="lexicographicToCoords-procs-all">
  <div id="lexicographicToCoords,int,seq[int],seq[int]">
  <dt><pre><span class="Keyword">proc</span> <a href="#lexicographicToCoords%2Cint%2Cseq%5Bint%5D%2Cseq%5Bint%5D"><span class="Identifier">lexicographicToCoords</span></a><span class="Other">(</span><span class="Identifier">idx</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">;</span> <span class="Identifier">strides</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span><span class="Other">;</span> <span class="Identifier">geom</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    Convert lexicographic index to coordinates
    
  </dd>
</div>

</div>
<div id="localToOuterInner-procs-all">
  <div id="localToOuterInner,int,SimdLatticeLayout">
  <dt><pre><span class="Keyword">proc</span> <a href="#localToOuterInner%2Cint%2CSimdLatticeLayout"><span class="Identifier">localToOuterInner</span></a><span class="Other">(</span><span class="Identifier">localIdx</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">;</span> <span class="Identifier">layout</span><span class="Other">:</span> <a href="simdlayout.html#SimdLatticeLayout"><span class="Identifier">SimdLatticeLayout</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Keyword">tuple</span><span class="Other">[</span>
    <span class="Identifier">outer</span><span class="Other">,</span> <span class="Identifier">inner</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">]</span> {.<span class="Identifier">inline</span><span class="Other">,</span> <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Convert local site index to (outerIdx, innerIdx) pair</p>
<p>Inverse of outerInnerToLocal.</p>

    
  </dd>
</div>

</div>
<div id="newSimdLatticeLayout-procs-all">
  <div id="newSimdLatticeLayout,openArray[int],openArray[int]">
  <dt><pre><span class="Keyword">proc</span> <a href="#newSimdLatticeLayout%2CopenArray%5Bint%5D%2CopenArray%5Bint%5D"><span class="Identifier">newSimdLatticeLayout</span></a><span class="Other">(</span><span class="Identifier">localGeom</span><span class="Other">:</span> <span class="Identifier">openArray</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span><span class="Other">;</span> <span class="Identifier">simdGrid</span><span class="Other">:</span> <span class="Identifier">openArray</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span><span class="Other">)</span><span class="Other">:</span> <a href="simdlayout.html#SimdLatticeLayout"><span class="Identifier">SimdLatticeLayout</span></a> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Create a new SIMD lattice layout</p>
<p>Parameters: localGeom: Local lattice dimensions (e.g., <a class="reference internal" href="#8, 8, 8, 16">8, 8, 8, 16</a>) simdGrid: SIMD lane grid per dimension (e.g., <a class="reference internal" href="#1, 2, 2, 2">1, 2, 2, 2</a> for 8 lanes)</p>
<p>The simdGrid must evenly divide localGeom in each dimension. Total SIMD lanes = product of simdGrid elements.</p>
<p>Example: let layout = newSimdLatticeLayout(<a class="reference internal" href="#8,8,8,16">8,8,8,16</a>, <a class="reference internal" href="#1,2,2,2">1,2,2,2</a>) # nSitesInner = 8 (SIMD width) # nSitesOuter = 1024 (outer loop iterations)</p>

    
  </dd>
</div>
<div id="newSimdLatticeLayout,openArray[int],int">
  <dt><pre><span class="Keyword">proc</span> <a href="#newSimdLatticeLayout%2CopenArray%5Bint%5D%2Cint"><span class="Identifier">newSimdLatticeLayout</span></a><span class="Other">(</span><span class="Identifier">localGeom</span><span class="Other">:</span> <span class="Identifier">openArray</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span><span class="Other">;</span> <span class="Identifier">simdWidth</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">)</span><span class="Other">:</span> <a href="simdlayout.html#SimdLatticeLayout"><span class="Identifier">SimdLatticeLayout</span></a> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Create SIMD layout with automatic lane distribution</p>
<p>Automatically distributes simdWidth lanes across dimensions, prioritizing faster-varying (lower) dimensions.</p>
<p>Example: let layout = newSimdLatticeLayout(<a class="reference internal" href="#8,8,8,16">8,8,8,16</a>, 8) # Might produce simdGrid = <a class="reference internal" href="#2,2,2,1">2,2,2,1</a> or <a class="reference internal" href="#1,1,2,4">1,1,2,4</a> depending on divisibility</p>

    
  </dd>
</div>

</div>
<div id="outerInnerToLocal-procs-all">
  <div id="outerInnerToLocal,int,int,SimdLatticeLayout">
  <dt><pre><span class="Keyword">proc</span> <a href="#outerInnerToLocal%2Cint%2Cint%2CSimdLatticeLayout"><span class="Identifier">outerInnerToLocal</span></a><span class="Other">(</span><span class="Identifier">outerIdx</span><span class="Other">,</span> <span class="Identifier">innerIdx</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">;</span> <span class="Identifier">layout</span><span class="Other">:</span> <a href="simdlayout.html#SimdLatticeLayout"><span class="Identifier">SimdLatticeLayout</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">int</span> {.
    <span class="Identifier">inline</span><span class="Other">,</span> <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Convert (outerIdx, innerIdx) pair to local site index</p>
<p>Given an outer index (vector group) and inner index (SIMD lane), returns the corresponding local site index.</p>
<p>Local coordinates: localCoord<a class="reference internal" href="#d">d</a> = outerCoord<a class="reference internal" href="#d">d</a> * innerGeom<a class="reference internal" href="#d">d</a> + innerCoord<a class="reference internal" href="#d">d</a></p>

    
  </dd>
</div>

</div>
<div id="simdLanes-procs-all">
  <div id="simdLanes,SimdLatticeLayout">
  <dt><pre><span class="Keyword">proc</span> <a href="#simdLanes%2CSimdLatticeLayout"><span class="Identifier">simdLanes</span></a><span class="Other">(</span><span class="Identifier">layout</span><span class="Other">:</span> <a href="simdlayout.html#SimdLatticeLayout"><span class="Identifier">SimdLatticeLayout</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">int</span> {.<span class="Identifier">inline</span><span class="Other">,</span> <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    Return the number of SIMD lanes (sites per vector group)
    
  </dd>
</div>

</div>
<div id="validateSimdGrid-procs-all">
  <div id="validateSimdGrid,openArray[int],openArray[int],openArray[int]">
  <dt><pre><span class="Keyword">proc</span> <a href="#validateSimdGrid%2CopenArray%5Bint%5D%2CopenArray%5Bint%5D%2CopenArray%5Bint%5D"><span class="Identifier">validateSimdGrid</span></a><span class="Other">(</span><span class="Identifier">globalGeom</span><span class="Other">,</span> <span class="Identifier">mpiGrid</span><span class="Other">,</span> <span class="Identifier">simdGrid</span><span class="Other">:</span> <span class="Identifier">openArray</span><span class="Other">[</span><span class="Identifier">int</span><span class="Other">]</span><span class="Other">)</span><span class="Other">:</span> <span class="Keyword">tuple</span><span class="Other">[</span>
    <span class="Identifier">valid</span><span class="Other">:</span> <span class="Identifier">bool</span><span class="Other">,</span> <span class="Identifier">message</span><span class="Other">:</span> <span class="Identifier">string</span><span class="Other">]</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Validate that simdGrid is compatible with the MPI partitioned lattice</p>
<p>Parameters: globalGeom: Global lattice dimensions (e.g., <a class="reference internal" href="#16, 16, 16, 32">16, 16, 16, 32</a>) mpiGrid: MPI rank grid (e.g., <a class="reference internal" href="#2, 2, 2, 2">2, 2, 2, 2</a>) simdGrid: Proposed SIMD lane grid (e.g., <a class="reference internal" href="#1, 2, 2, 2">1, 2, 2, 2</a>)</p>
<p>Returns: (valid, message) where valid=true if compatible, false otherwise with error message</p>
<p>Example: let (ok, msg) = validateSimdGrid(<a class="reference internal" href="#16,16,16,32">16,16,16,32</a>, <a class="reference internal" href="#2,2,2,2">2,2,2,2</a>, <a class="reference internal" href="#1,2,2,2">1,2,2,2</a>) if not ok: echo &quot;Error: &quot;, msg</p>

    
  </dd>
</div>

</div>
<div id="vectorGroups-procs-all">
  <div id="vectorGroups,SimdLatticeLayout">
  <dt><pre><span class="Keyword">proc</span> <a href="#vectorGroups%2CSimdLatticeLayout"><span class="Identifier">vectorGroups</span></a><span class="Other">(</span><span class="Identifier">layout</span><span class="Other">:</span> <a href="simdlayout.html#SimdLatticeLayout"><span class="Identifier">SimdLatticeLayout</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">int</span> {.<span class="Identifier">inline</span><span class="Other">,</span> <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    Return the number of vector groups (outer loop iterations)
    
  </dd>
</div>

</div>

  </dl>
</div>

  </div>
</div>

      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br>
        <small style="color: var(--hint);">Made with Nim. Generated: 2026-02-07 06:49:57 UTC</small>
      </div>
    </div>
  </div>
  
</body>
</html>
